(function(){window.REDEFINE=1;window.RESET=2;window.ORIGINAL='ORG';window.define=function(fullName,object,flags){if(flags==undefined)flags=0;if(window.definitions==undefined)window.definitions={};if(window.definitions[fullName]==undefined||(flags&RESET)){window.definitions[fullName]={_blocked:!1,_state:'unknown',_cbs:[],_org:null,_object:object,state:function(){return this._state},obj:function(org){return org=='ORG'?this._org:this._object},then:function(a,b){if(b==undefined){b=a;a='any'}
a=(a+'').toLowerCase();if(a=='any'||this._state==a){if(this._blocked)
this._cbs.push(function(){b(a,definitions[fullName])});else b(a,this)}
return this},_invoke:function(){var current=window;var scopes=fullName.split('.');identifier=scopes.pop();if(scopes.length>0){for(var i=0;i<scopes.length;i++){current=(current[scopes[i]]==undefined)?(current[scopes[i]]={}):current[scopes[i]]}}
if(current[identifier]!=undefined){if((flags&REDEFINE)||(flags&RESET)){this._state='redefined';this._org=current[identifier]}
else{this._state='kept'}}
else this._state='defined';flags=flags&~RESET;if(this._blocked){definitives.defs.push(this);return this}
if(this._state!='kept')
current[identifier]=object;while(this._cbs.length>0){var fn=this._cbs.splice(0,1)[0];fn()}
return this}}}
var retVal=null;(retVal=window.definitions[fullName])._blocked=definitives._blocked>0;return retVal._invoke()};if(!window.definitives){window.definitives={_blocked:0,defs:[],block:function(){this._blocked++},unblock:function(){if((this._blocked=Math.max(this._blocked-1,0))<=0){var d=this.defs;this.defs=[];for(var i=0;i<d.length;i++){d[i]._blocked=!1;d[i]._invoke()}
return!0}return!1}}}})();
